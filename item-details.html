<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nautilus.CIM - –ü—Ä–æ—Å–º–æ—Ç—Ä –æ–±—ä–µ–∫—Ç–æ–≤</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .object-viewer-container {
            display: flex;
            height: 100%;
            gap: 0;
        }

        .model-tree-panel {
            width: 400px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
        }

        .model-header {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-secondary);
        }

        .model-title {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .model-tree-content {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .object-details-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-primary);
        }

        .details-toolbar {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 12px 20px;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .details-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .object-header {
            margin-bottom: 20px;
        }

        .object-name-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .object-name {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .object-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .object-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .object-field {
            margin-bottom: 20px;
        }

        .field-label {
            display: block;
            font-weight: 500;
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .field-value-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .field-value-textarea {
            width: 100%;
            min-height: 120px;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-family: inherit;
            resize: vertical;
        }

        .additional-info {
            margin-top: 30px;
        }

        .section-title {
            font-weight: 600;
            font-size: 15px;
            color: var(--text-primary);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--border-color);
        }

        .attributes-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .attributes-table th {
            background: var(--bg-secondary);
            padding: 10px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }

        .attributes-table td {
            padding: 10px;
            border: 1px solid var(--border-color);
            font-size: 14px;
            background: var(--bg-secondary);
        }

        .attributes-table tr:hover {
            background: rgba(33, 128, 133, 0.05);
        }

        .link-cell {
            color: var(--primary-color);
            text-decoration: underline;
            cursor: pointer;
        }

        .link-cell:hover {
            color: var(--primary-hover);
        }

        .connections-table {
            width: 100%;
            border-collapse: collapse;
        }

        .connections-table th {
            background: var(--bg-secondary);
            padding: 10px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }

        .connections-table td {
            padding: 10px;
            border: 1px solid var(--border-color);
            font-size: 14px;
            background: var(--bg-secondary);
        }

        .connections-table tr:hover {
            background: rgba(33, 128, 133, 0.05);
        }

        .view-mode {
            background: var(--bg-primary);
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .tree-node {
            user-select: none;
        }

        .tree-node-header {
            display: flex;
            align-items: center;
            padding: 5px 8px;
            cursor: pointer;
            border-radius: 4px;
            transition: background 0.15s;
        }

        .tree-node-header:hover {
            background: rgba(33, 128, 133, 0.1);
        }

        .tree-node-header.selected {
            background: rgba(33, 128, 133, 0.2);
            font-weight: 600;
        }

        .tree-expand-toggle {
            width: 16px;
            height: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 5px;
            font-size: 12px;
            cursor: pointer;
            color: var(--text-secondary);
        }

        .tree-expand-toggle.empty {
            visibility: hidden;
        }

        .tree-icon {
            margin-right: 6px;
            font-size: 14px;
        }

        .tree-node-label {
            font-size: 14px;
            color: var(--text-primary);
            flex: 1;
        }

        .tree-children {
            margin-left: 20px;
            display: none;
        }

        .tree-children.expanded {
            display: block;
        }

        .placeholder-text {
            text-align: center;
            color: var(--text-secondary);
            padding: 60px 20px;
            font-size: 14px;
        }

        .placeholder-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- SIDEBAR -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <strong>Nautilus.CIM</strong>
            </div>
            <div class="sidebar-nav">
                <a href="index.html" class="nav-item">üìä –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</a>
                <a href="projects.html" class="nav-item">üìÅ –ü—Ä–æ–µ–∫—Ç—ã</a>
                <a href="models.html" class="nav-item">üìã –ú–æ–¥–µ–ª–∏</a>
                <a href="profiles.html" class="nav-item">‚öôÔ∏è –ü—Ä–æ—Ñ–∏–ª–∏</a>
                
                <div class="nav-section-title">–¢–µ–∫—É—â–∏–π –ø—Ä–æ–µ–∫—Ç</div>
                <div id="current-project" class="text-muted">
                    –ù–µ—Ç –ø—Ä–æ–µ–∫—Ç–∞
                </div>

                <div class="nav-section-title">–î–µ–π—Å—Ç–≤–∏—è</div>
                <a href="diagram.html" class="nav-item">üìê –î–∏–∞–≥—Ä–∞–º–º–∞ –∫–ª–∞—Å—Å–æ–≤</a>
                <a href="compare.html" class="nav-item">üîç –°—Ä–∞–≤–Ω–µ–Ω–∏–µ</a>
            </div>
        </div>

        <!-- MAIN CONTENT -->
        <div class="main-content">
            <div class="toolbar">
                <div class="toolbar-title">–ü—Ä–æ—Å–º–æ—Ç—Ä –æ–±—ä–µ–∫—Ç–æ–≤ –º–æ–¥–µ–ª–∏</div>
                <div class="toolbar-actions">
                    <button class="btn btn-secondary" onclick="importModel()">–ò–º–ø–æ—Ä—Ç</button>
                    <button class="btn btn-secondary" onclick="createObject()">–°–æ–∑–¥–∞—Ç—å</button>
                    <button class="btn btn-secondary" onclick="modifyObject()">–ò–∑–º–µ–Ω–∏—Ç—å</button>
                    <button class="btn btn-primary" onclick="exportModel()">–≠–∫—Å–ø–æ—Ä—Ç</button>
                </div>
            </div>

            <div class="view-mode">
                –†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
            </div>

            <div class="content-area" style="padding: 0;">
                <div class="object-viewer-container">
                    <!-- LEFT PANEL: Model Tree -->
                    <div class="model-tree-panel">
                        <div class="model-header">
                            <div class="model-title">XXXX (–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞)</div>
                            <div class="search-box">
                                <input type="text" class="search-input" id="tree-search" placeholder="–ü–æ–∏—Å–∫" oninput="filterTree()">
                                <button class="btn btn-small btn-secondary" style="margin-top: 8px;" onclick="searchInTree()">–ù–∞–π—Ç–∏</button>
                            </div>
                        </div>
                        <div class="model-tree-content" id="model-tree">
                            <!-- Tree will be rendered here -->
                        </div>
                    </div>

                    <!-- RIGHT PANEL: Object Details -->
                    <div class="object-details-panel">
                        <div class="details-content" id="object-details">
                            <div class="placeholder-text">
                                <div class="placeholder-icon">üìÑ</div>
                                <p>–í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç –∏–∑ –¥–µ—Ä–µ–≤–∞ –º–æ–¥–µ–ª–∏<br>–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –µ–≥–æ —Å–≤–æ–π—Å—Ç–≤</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="data.js"></script>
    <script>
        // Sample model structure based on CIM16.json
        const modelData = {
            name: "TC57 (Model)",
            children: [
                {
                    name: "TC57CIM",
                    type: "package",
                    children: [
                        {
                            name: "IEC61970",
                            type: "package",
                            children: [
                                {
                                    name: "AssetInfo",
                                    type: "package",
                                    children: [
                                        {
                                            name: "RotatingMachineInfo",
                                            type: "class",
                                            stereotype: "¬´rf¬ª",
                                            isAbstract: false,
                                            attributes: [
                                                { name: "rotorGD2", type: "Torque", multiplicity: "0..1", description: "–ú–∞—Ö–æ–≤—ã–π –º–æ–º–µ–Ω—Ç —Ä–æ—Ç–æ—Ä–∞ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞, —Ç √ó –º2" }
                                            ],
                                            connections: [
                                                { name: "AssetInfo", type: "Generalization (—Ä–æ–¥–∏—Ç–µ–ª—å)", targetClass: "AssetInfo", multiplicity: "" },
                                                { name: "AsynchronousMachineInfo", type: "Generalization (–ø–æ—Ç–æ–º–æ–∫)", targetClass: "AsynchronousMachineInfo", multiplicity: "" },
                                                { name: "SynchronousMachineInfo", type: "Generalization (–ø–æ—Ç–æ–º–æ–∫)", targetClass: "SynchronousMachineInfo", multiplicity: "" },
                                                { name: "TestInfo", type: "Association", targetClass: "TestInfo", multiplicity: "0..*", description: "–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–æ–π –≤—Ä–∞—â–∞—é—â–µ–π—Å—è –º–∞—à–∏–Ω—ã" }
                                            ],
                                            descriptionEn: "",
                                            descriptionRu: "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–æ–π –≤—Ä–∞—â–∞—é—â–µ–π—Å—è –º–∞—à–∏–Ω—ã",
                                            additionalInfoRu: ""
                                        },
                                        {
                                            name: "TestInfo",
                                            type: "class",
                                            stereotype: "¬´rf¬ª",
                                            attributes: []
                                        }
                                    ]
                                },
                                {
                                    name: "Domain",
                                    type: "package",
                                    children: []
                                }
                            ]
                        },
                        {
                            name: "IEC61968",
                            type: "package",
                            children: []
                        }
                    ]
                },
                {
                    name: "GOSTExt (Model)",
                    type: "package",
                    children: [
                        {
                            name: "GOSTExtention",
                            type: "package",
                            children: [
                                {
                                    name: "AssetInfo",
                                    type: "package",
                                    children: []
                                },
                                {
                                    name: "Domain",
                                    type: "package",
                                    children: []
                                }
                            ]
                        }
                    ]
                },
                {
                    name: "TC57CIM",
                    type: "package",
                    children: [
                        {
                            name: "IEC61970",
                            type: "package",
                            children: []
                        },
                        {
                            name: "IEC61968",
                            type: "package",
                            children: []
                        }
                    ]
                },
                {
                    name: "GOST-58651.2 (Profile)",
                    type: "profile"
                },
                {
                    name: "GOST-58651.3 (Profile)",
                    type: "profile"
                },
                {
                    name: "GOST-TEST (Profile)",
                    type: "profile",
                    children: [
                        {
                            name: "GOSTExtention-NEW",
                            type: "package",
                            children: [
                                {
                                    name: "AssetInfo",
                                    type: "package",
                                    children: []
                                },
                                {
                                    name: "Domain",
                                    type: "package",
                                    children: []
                                }
                            ]
                        }
                    ]
                },
                {
                    name: "MeterProfile (Profile)",
                    type: "profile"
                }
            ]
        };

        let selectedObject = null;

        document.addEventListener('DOMContentLoaded', () => {
            if (typeof loadSampleData === 'function') loadSampleData();
            if (typeof updateCurrentProject === 'function') updateCurrentProject();
            renderModelTree();
        });

        function renderModelTree() {
            const container = document.getElementById('model-tree');
            container.innerHTML = renderTreeNode(modelData, 0);
        }

        function renderTreeNode(node, level) {
            const hasChildren = node.children && node.children.length > 0;
            const icon = getNodeIcon(node.type);
            const nodeId = 'node-' + Math.random().toString(36).substr(2, 9);
            
            let html = '<div class="tree-node">';
            html += `<div class="tree-node-header" onclick="selectNode(this, ${JSON.stringify(node).replace(/"/g, '&quot;')})">`;
            
            if (hasChildren) {
                html += `<span class="tree-expand-toggle" onclick="toggleNode(event, this)">‚ñ∂</span>`;
            } else {
                html += `<span class="tree-expand-toggle empty">‚Ä¢</span>`;
            }
            
            html += `<span class="tree-icon">${icon}</span>`;
            html += `<span class="tree-node-label">${node.name}</span>`;
            html += '</div>';
            
            if (hasChildren) {
                html += '<div class="tree-children">';
                node.children.forEach(child => {
                    html += renderTreeNode(child, level + 1);
                });
                html += '</div>';
            }
            
            html += '</div>';
            return html;
        }

        function getNodeIcon(type) {
            const icons = {
                'package': 'üìÅ',
                'class': 'üìÑ',
                'profile': '‚öôÔ∏è',
                'model': 'üì¶'
            };
            return icons[type] || 'üìÑ';
        }

        function toggleNode(event, element) {
            event.stopPropagation();
            const parent = element.closest('.tree-node');
            const children = parent.querySelector('.tree-children');
            
            if (children) {
                const isExpanded = children.classList.contains('expanded');
                children.classList.toggle('expanded');
                element.textContent = isExpanded ? '‚ñ∂' : '‚ñº';
            }
        }

        function selectNode(element, nodeData) {
            // Remove previous selection
            document.querySelectorAll('.tree-node-header').forEach(el => {
                el.classList.remove('selected');
            });
            
            // Add selection to clicked node
            element.classList.add('selected');
            
            // Parse node data if it's a string
            if (typeof nodeData === 'string') {
                try {
                    nodeData = JSON.parse(nodeData);
                } catch (e) {
                    console.error('Failed to parse node data:', e);
                    return;
                }
            }
            
            selectedObject = nodeData;
            renderObjectDetails(nodeData);
        }

        function renderObjectDetails(node) {
            const container = document.getElementById('object-details');
            
            if (!node || node.type !== 'class') {
                container.innerHTML = `
                    <div class="placeholder-text">
                        <div class="placeholder-icon">üìÑ</div>
                        <p>–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å –∏–∑ –¥–µ—Ä–µ–≤–∞ –º–æ–¥–µ–ª–∏<br>–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –µ–≥–æ —Å–≤–æ–π—Å—Ç–≤</p>
                    </div>`;
                return;
            }
            
            let html = '<div class="object-header">';
            html += '<div class="object-name-row">';
            html += `<div class="object-name">${node.name}</div>`;
            html += '<div class="object-checkbox">';
            html += '<label><input type="checkbox" ' + (node.isAbstract ? 'checked' : '') + '> –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å</label>';
            html += '</div>';
            html += '</div>';
            
            // Stereotype field
            html += '<div class="object-field">';
            html += '<label class="field-label">–°—Ç–µ—Ä–µ–æ—Ç–∏–ø</label>';
            html += `<input type="text" class="field-value-input" value="${node.stereotype || 'rf'}" readonly>`;
            html += '</div>';
            html += '</div>';
            
            // Description fields
            html += '<div class="object-field">';
            html += '<label class="field-label">–û–ø–∏—Å–∞–Ω–∏–µ (–∞–Ω–≥–ª)</label>';
            html += `<textarea class="field-value-textarea" readonly>${node.descriptionEn || ''}</textarea>`;
            html += '</div>';
            
            html += '<div class="object-field">';
            html += '<label class="field-label">–û–ø–∏—Å–∞–Ω–∏–µ (—Ä—É—Å)</label>';
            html += `<textarea class="field-value-textarea" readonly>${node.descriptionRu || ''}</textarea>`;
            html += '</div>';
            
            html += '<div class="object-field">';
            html += '<label class="field-label">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (—Ä—É—Å)</label>';
            html += `<textarea class="field-value-textarea" readonly>${node.additionalInfoRu || ''}</textarea>`;
            html += '</div>';
            
            // Attributes section
            if (node.attributes && node.attributes.length > 0) {
                html += '<div class="additional-info">';
                html += '<div class="section-title">–ê—Ç—Ä–∏–±—É—Ç—ã</div>';
                html += '<table class="attributes-table">';
                html += '<thead><tr>';
                html += '<th>–ò–º—è</th><th>–¢–∏–ø</th><th>–ú–Ω</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th>';
                html += '</tr></thead><tbody>';
                
                node.attributes.forEach(attr => {
                    html += '<tr>';
                    html += `<td><span class="link-cell">${attr.name}</span></td>`;
                    html += `<td>${attr.type}</td>`;
                    html += `<td>${attr.multiplicity}</td>`;
                    html += `<td>${attr.description || ''}</td>`;
                    html += '</tr>';
                });
                
                html += '</tbody></table>';
                html += '</div>';
            }
            
            // Connections section
            if (node.connections && node.connections.length > 0) {
                html += '<div class="additional-info">';
                html += '<div class="section-title">–°–≤—è–∑–∏</div>';
                html += '<table class="connections-table">';
                html += '<thead><tr>';
                html += '<th>–ò–º—è —Å–≤—è–∑–∏</th><th>–¢–∏–ø —Å–≤—è–∑–∏</th><th>–ö–ª–∞—Å—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</th><th>–ú–Ω</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th>';
                html += '</tr></thead><tbody>';
                
                node.connections.forEach(conn => {
                    html += '<tr>';
                    html += `<td>${conn.name}</td>`;
                    html += `<td>${conn.type}</td>`;
                    html += `<td><span class="link-cell">${conn.targetClass}</span></td>`;
                    html += `<td>${conn.multiplicity || ''}</td>`;
                    html += `<td>${conn.description || ''}</td>`;
                    html += '</tr>';
                });
                
                html += '</tbody></table>';
                html += '</div>';
            }
            
            container.innerHTML = html;
        }

        function filterTree() {
            const query = document.getElementById('tree-search').value.toLowerCase();
            const nodes = document.querySelectorAll('.tree-node');
            
            nodes.forEach(node => {
                const label = node.querySelector('.tree-node-label');
                if (label) {
                    const text = label.textContent.toLowerCase();
                    const matches = text.includes(query);
                    node.style.display = matches || query === '' ? 'block' : 'none';
                }
            });
        }

        function searchInTree() {
            filterTree();
        }

        function importModel() {
            alert('–§—É–Ω–∫—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }

        function createObject() {
            alert('–§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }

        function modifyObject() {
            if (!selectedObject) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è');
                return;
            }
            alert('–§—É–Ω–∫—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }

        function exportModel() {
            alert('–§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }
    </script>
</body>
</html>
