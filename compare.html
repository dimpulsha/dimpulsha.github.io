<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nautilus.CIM - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ</title>
    <link rel="stylesheet" href="styles.css" />
    <style>
      .editor-panel-content {
        padding: 10px;
        overflow-y: auto;
        max-height: 400px;
      }
      .tree-item-with-checkbox {
        display: flex;
        align-items: center;
        padding: 3px 0;
        white-space: nowrap;
      }
      .tree-item-checkbox {
        margin-right: 8px;
        cursor: pointer;
      }
      .tree-item-label {
        cursor: pointer;
        user-select: none;
        font-size: 15px;
        white-space: nowrap;
      }
      .tree-toggle {
        display: inline-block;
        width: 20px;
        cursor: pointer;
        user-select: none;
        font-size: 18px;
        margin-right: 4px;
        text-align: center;
      }
      .tree-children {
        display: block;
        margin-left: 20px;
      }
      .tree-children.collapsed {
        display: none;
      }
      .tree-item-with-checkbox:hover {
        background-color: #f5f5f5;
      }
    </style>
  </head>
  <body>
    <div class="app-container">
      <!-- SIDEBAR -->
      <div class="sidebar">
        <div class="sidebar-header">
          <strong>Nautilus.CIM</strong>
        </div>
        <div class="sidebar-nav">
          <a href="index.html" class="nav-item">üìä –ì–ª–∞–≤–Ω–∞—è</a>
          <a href="projects.html" class="nav-item">üìÅ –ü—Ä–æ–µ–∫—Ç—ã</a>
          <!-- <a href="models.html" class="nav-item">üìã –ú–æ–¥–µ–ª–∏</a>
                <a href="profiles.html" class="nav-item">‚öôÔ∏è –ü—Ä–æ—Ñ–∏–ª–∏</a> -->

          <div class="nav-section-title">–¢–µ–∫—É—â–∏–π –ø—Ä–æ–µ–∫—Ç</div>
          <div
            id="current-project"
            style="
              padding: 10px 15px;
              font-size: 12px;
              color: rgba(255, 255, 255, 0.7);
            "
          >
            –ù–µ—Ç –ø—Ä–æ–µ–∫—Ç–∞
          </div>

          <div class="nav-section-title">–î–µ–π—Å—Ç–≤–∏—è</div>
          <div class="nav-item" onclick="openModal('new-project-modal')">
            + –ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
          </div>
          <!-- <div class="nav-item" onclick="openModal('new-model-modal')">‚¨ÜÔ∏è –ò–º–ø–æ—Ä—Ç –º–æ–¥–µ–ª–∏</div>
                <a href="compare.html" class="nav-item active">üîç –°—Ä–∞–≤–Ω–µ–Ω–∏–µ</a> -->
        </div>
      </div>

      <!-- MAIN CONTENT -->
      <div class="main-content">
        <div class="toolbar">
          <div class="toolbar-title">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ</div>
          <div class="toolbar-actions">
            <button class="btn btn-primary" onclick="compareProfiles()">
              üîç –°—Ä–∞–≤–Ω–∏—Ç—å
            </button>
          </div>
        </div>

        <div class="content-area">
          <div id="compare-container" class="compare-container">
            <!-- Selection Area -->
            <div class="card" style="margin-bottom: 20px">
              <h3 style="margin-bottom: 15px">–í—ã–±–æ—Ä –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è</h3>
              <div class="compare-selection-grid">
                <div>
                  <div class="form-group">
                    <label class="form-label">–û–±—ä–µ–∫—Ç 1 (—á—Ç–æ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º)</label>
                    <select id="profile1" class="form-select">
                      <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>
                    </select>
                  </div>

                  <div id="compare-object-one-content" class="hidden"></div>
                </div>
                <div>
                  <div class="form-group">
                    <label class="form-label"
                      >–û–±—ä–µ–∫—Ç 2 (—Å —á–µ–º —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º)</label
                    >
                    <select id="profile2" class="form-select">
                      <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>
                    </select>
                  </div>
                  <div id="compare-object-two-content" class="hidden"></div>
                </div>
              </div>

              <div class="divider mt-15 mb-10"></div>
              <form class="compare-settings">
                <div class="form-group">
                  <div class="flex gap-15">
                    <label class="form-label">–†–µ–∂–∏–º —Å—Ä–∞–≤–Ω–µ–Ω–∏—è</label>
                    <div class="flex gap-15">
                      <label>
                        <input
                          type="radio"
                          name="compareMode"
                          value="full"
                          checked
                        />
                        –ø–æ–ª–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
                      </label>
                      <label>
                        <input
                          type="radio"
                          name="compareMode"
                          value="selective"
                        />
                        –≤—ã–±–æ—Ä–æ—á–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
                      </label>
                      <label>
                        <input
                          type="radio"
                          name="compareMode"
                          value="analysis"
                        />
                        —Ä–µ–∂–∏–º –∞–Ω–∞–ª–∏–∑–∞
                      </label>
                    </div>
                  </div>
                </div>
              </form>

              <div class="divider mt-15 mb-10"></div>

              <div class="quick-actions">
                <button class="btn btn-primary" onclick="compareProfiles()">
                  üîç –°—Ä–∞–≤–Ω–∏—Ç—å
                </button>
              </div>
            </div>

            <!-- Comparison Results -->
            <div
              id="comparison-results"
              class="comparison-results"
              style="display: none"
            >
              <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è</h3>

              <!-- Summary Stats -->
              <div class="comparison-stats">
                <div class="stat-box">
                  <div class="stat-value" id="stat-common">0</div>
                  <div class="stat-label">–û–±—â–∏—Ö –∫–ª–∞—Å—Å–æ–≤</div>
                </div>
                <div class="stat-box">
                  <div class="stat-value" id="stat-unique1">0</div>
                  <div class="stat-label">–¢–æ–ª—å–∫–æ –≤ –ø—Ä–æ—Ñ–∏–ª–µ 1</div>
                </div>
                <div class="stat-box">
                  <div class="stat-value" id="stat-unique2">0</div>
                  <div class="stat-label">–¢–æ–ª—å–∫–æ –≤ –ø—Ä–æ—Ñ–∏–ª–µ 2</div>
                </div>
              </div>

              <!-- Detailed Comparison -->
              <div class="diff-container">
                <div class="diff-panel">
                  <div class="diff-header" id="profile1-name">–ü—Ä–æ—Ñ–∏–ª—å 1</div>
                  <div class="diff-content" id="profile1-details"></div>
                </div>
                <div class="diff-panel">
                  <div class="diff-header" id="profile2-name">–ü—Ä–æ—Ñ–∏–ª—å 2</div>
                  <div class="diff-content" id="profile2-details"></div>
                </div>
              </div>

              <!-- Differences List -->
              <div class="differences-section">
                <h4>–î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è</h4>
                <div id="differences-list"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- <div id="new-project-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</div>
            <p style="color:var(--text-secondary); margin-bottom:15px;">–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤ —Ä–∞–∑–¥–µ–ª–µ "–ü—Ä–æ–µ–∫—Ç—ã"</p>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="window.location.href='projects.html'">–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø—Ä–æ–µ–∫—Ç–∞–º</button>
            </div>
        </div>
    </div> -->

    <!-- <div id="new-model-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –º–æ–¥–µ–ª—å</div>
            <p style="color:var(--text-secondary); margin-bottom:15px;">–î–æ–±–∞–≤—å—Ç–µ –º–æ–¥–µ–ª—å –≤ —Ä–∞–∑–¥–µ–ª–µ "–ú–æ–¥–µ–ª–∏"</p>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="window.location.href='models.html'">–ü–µ—Ä–µ–π—Ç–∏ –∫ –º–æ–¥–µ–ª—è–º</button>
            </div>
        </div>
    </div> -->

    <script src="data.js"></script>
    <script>
      // Helper function for HTML escaping
      function esc(v) {
        if (v === undefined || v === null) return '';
        const d = document.createElement('div');
        d.textContent = String(v);
        return d.innerHTML;
      }

      document.addEventListener("DOMContentLoaded", async () => {
        await loadSampleData();
        updateCurrentProject();
        loadAllObjectOptions();
        initCompareSettingsLogic();
      });

      function initCompareSettingsLogic() {
        const radios = document.querySelectorAll('input[name="compareMode"]');
        const objOneContent = document.getElementById('compare-object-one-content');
        const objTwoContent = document.getElementById('compare-object-two-content');
        const profile1Select = document.getElementById('profile1');
        const profile2Select = document.getElementById('profile2');

        function applyMode(mode) {
          if (mode === 'full') {
            objOneContent.classList.add('hidden');
            objOneContent.innerHTML = '';
            objTwoContent.classList.add('hidden');
            objTwoContent.innerHTML = '';
          } else if (mode === 'selective') {
            // Require an object selected in profile1
            const val = profile1Select.value;
            if (!val) {
              alert('–í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç 1 –¥–ª—è –≤—ã–±–æ—Ä–æ—á–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è');
              objOneContent.classList.add('hidden');
              objOneContent.innerHTML = '';
              objTwoContent.classList.add('hidden');
              objTwoContent.innerHTML = '';
              return;
            }
            const obj = parseObjectValue(val);
            if (!obj) {
              alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞');
              objOneContent.classList.add('hidden');
              objOneContent.innerHTML = '';
              objTwoContent.classList.add('hidden');
              objTwoContent.innerHTML = '';
              return;
            }
            // Render tree for selected object
            currentSelectiveObject = obj; // Save for re-rendering
            objOneContent.classList.remove('hidden');
            objOneContent.innerHTML = renderObjectTreePanel(obj);
            objTwoContent.classList.add('hidden');
            objTwoContent.innerHTML = '';
          } else if (mode === 'analysis') {
            // Require both objects selected
            const val1 = profile1Select.value;
            const val2 = profile2Select.value;
            if (!val1 || !val2) {
              alert('–í—ã–±–µ—Ä–∏—Ç–µ –æ–±–∞ –æ–±—ä–µ–∫—Ç–∞ –¥–ª—è —Ä–µ–∂–∏–º–∞ –∞–Ω–∞–ª–∏–∑–∞');
              objOneContent.classList.add('hidden');
              objOneContent.innerHTML = '';
              objTwoContent.classList.add('hidden');
              objTwoContent.innerHTML = '';
              return;
            }
            const obj1 = parseObjectValue(val1);
            const obj2 = parseObjectValue(val2);
            if (!obj1 || !obj2) {
              alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤');
              objOneContent.classList.add('hidden');
              objOneContent.innerHTML = '';
              objTwoContent.classList.add('hidden');
              objTwoContent.innerHTML = '';
              return;
            }
            // Render trees for both objects
            currentSelectiveObject = obj1;
            currentSelectiveObject2 = obj2;
            objOneContent.classList.remove('hidden');
            objOneContent.innerHTML = renderObjectTreePanel(obj1);
            objTwoContent.classList.remove('hidden');
            objTwoContent.innerHTML = renderObjectTreePanel(obj2);
          }
        }

        // Initial apply based on default checked
        const checked = document.querySelector('input[name="compareMode"]:checked');
        applyMode(checked ? checked.value : 'full');

        // Listen for mode changes
        radios.forEach(r => {
          r.addEventListener('change', e => applyMode(e.target.value));
        });

        // If selection changes while in selective or analysis mode, re-render
        profile1Select.addEventListener('change', () => {
          const current = document.querySelector('input[name="compareMode"]:checked');
          if (current && (current.value === 'selective' || current.value === 'analysis')) {
            applyMode(current.value);
          }
        });

        profile2Select.addEventListener('change', () => {
          const current = document.querySelector('input[name="compareMode"]:checked');
          if (current && current.value === 'analysis') {
            applyMode('analysis');
          }
        });
      }

      function renderObjectTreePanel(obj) {
        // Panel header mimicking editor-panel-content style
        const title = `${obj.name} ‚Äî ${obj.objectType === 'model' ? '–ú–æ–¥–µ–ª—å' : '–ü—Ä–æ—Ñ–∏–ª—å'}`;
        const treeHtml = renderSelectiveTree(obj);
        return `
          <div class="card">

            <div class="editor-panel-content">${treeHtml}</div>
          </div>
        `;
      }

      // State for selective tree
      let selectiveExpanded = new Set();
      let selectiveSelected = new Set();
      let currentSelectiveObject = null; // Store current object for re-rendering
      let currentSelectiveObject2 = null; // Store second object for analysis mode

      function renderSelectiveTree(obj) {
        const root = obj.rootPackages || [];
        const baseKey = `sel-${obj.objectType}-${obj.id}`;
        let html = '';
        root.forEach((pkg, idx) => {
          const itemKey = `${baseKey}-pkg-${idx}`;
          html += renderSelectiveNode(pkg, itemKey, 0);
        });
        if (!html) {
          html = '<div class="text-center text-muted" style="padding: 10px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>';
        }
        return html;
      }

      function renderSelectiveNode(node, itemKey, level) {
        const name = esc(node?.name || node?.className || '–ë–µ–∑ –∏–º–µ–Ω–∏');
        const childrenPkgs = Array.isArray(node.children) ? node.children : Array.isArray(node.packages) ? node.packages : [];
        const elements = Array.isArray(node.elements) ? node.elements : [];
        const hasChildren = (childrenPkgs && childrenPkgs.length) || (elements && elements.length);
        const isExpanded = selectiveExpanded.has(itemKey);
        const isChecked = selectiveSelected.has(itemKey);

        let html = `
          <div class="tree-item-with-checkbox" onclick="toggleSelectiveActive('${itemKey}', event)">
            <span class="tree-toggle" onclick="toggleSelectiveExpand('${itemKey}'); event.stopPropagation();">${hasChildren ? (isExpanded ? '‚ñæ' : '‚ñ∏') : ''}</span>
            <input type="checkbox" id="${itemKey}" class="tree-item-checkbox" ${isChecked ? 'checked' : ''} onclick="toggleSelectiveCheck('${itemKey}', event)">
            <span class="tree-item-label">üì¶ ${name}</span>
          </div>
        `;

        if (hasChildren) {
          html += `<div class="tree-children ${isExpanded ? '' : 'collapsed'}" id="children-${itemKey}">`;
          // elements first
          elements.forEach((el, eidx) => {
            const eKey = `${itemKey}-elem-${eidx}`;
            const eName = esc(el?.name || el);
            const eChecked = selectiveSelected.has(eKey);
            html += `
              <div class="tree-item-with-checkbox" onclick="toggleSelectiveActive('${eKey}', event)">
                <span class="tree-toggle"></span>
                <input type="checkbox" id="${eKey}" class="tree-item-checkbox" ${eChecked ? 'checked' : ''} onclick="toggleSelectiveCheck('${eKey}', event)">
                <span class="tree-item-label">üìÑ ${eName}</span>
              </div>
            `;
          });
          // child packages
          childrenPkgs.forEach((pkg, pidx) => {
            const cKey = `${itemKey}-pkg-${pidx}`;
            html += renderSelectiveNode(pkg, cKey, level + 1);
          });
          html += `</div>`;
        }

        return html;
      }

      // Selective tree interactions
      function toggleSelectiveExpand(itemKey) {
        if (selectiveExpanded.has(itemKey)) selectiveExpanded.delete(itemKey);
        else selectiveExpanded.add(itemKey);
        // re-render current selective panel using saved object
        if (currentSelectiveObject) {
          document.getElementById('compare-object-one-content').innerHTML = renderObjectTreePanel(currentSelectiveObject);
        }
      }

      function toggleSelectiveCheck(itemKey, evt) {
        if (evt) evt.stopPropagation();
        const input = document.getElementById(itemKey);
        if (input && input.checked) selectiveSelected.add(itemKey);
        else selectiveSelected.delete(itemKey);
      }

      function toggleSelectiveActive(itemKey, evt) {
        if (evt) evt.stopPropagation();
        // For future: highlight active item, update details
      }

      function loadAllObjectOptions() {
        // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –ø—Ä–æ–µ–∫—Ç—ã
        const projects = MemoryStore.getProjects();

        let options = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç --</option>';

        // –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ –ø—Ä–æ–µ–∫—Ç—ã –∏ —Å–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –º–æ–¥–µ–ª–∏ –∏ –ø—Ä–æ—Ñ–∏–ª–∏
        projects.forEach((project) => {
          // –î–æ–±–∞–≤–ª—è–µ–º –º–æ–¥–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞
          if (project.models && project.models.length > 0) {
            options += `<optgroup label="${project.name} - –ú–æ–¥–µ–ª–∏">`;
            project.models.forEach((model) => {
              options += `<option value="model-${project.id}-${model.id}">${model.name} (${model.type})</option>`;
            });
            options += "</optgroup>";
          }

          // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞
          if (project.profiles && project.profiles.length > 0) {
            options += `<optgroup label="${project.name} - –ü—Ä–æ—Ñ–∏–ª–∏">`;
            project.profiles.forEach((profile) => {
              options += `<option value="profile-${project.id}-${profile.id}">${profile.name} v${profile.version}</option>`;
            });
            options += "</optgroup>";
          }
        });

        document.getElementById("profile1").innerHTML = options;
        document.getElementById("profile2").innerHTML = options;
      }

      function compareProfiles() {
        const object1Value = document.getElementById("profile1").value;
        const object2Value = document.getElementById("profile2").value;

        if (!object1Value || !object2Value) {
          alert("–í—ã–±–µ—Ä–∏—Ç–µ –¥–≤–∞ –æ–±—ä–µ–∫—Ç–∞ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è");
          return;
        }

        if (object1Value === object2Value) {
          alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã");
          return;
        }

        // –ü–∞—Ä—Å–∏–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        const object1 = parseObjectValue(object1Value);
        const object2 = parseObjectValue(object2Value);

        if (!object1 || !object2) {
          alert("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤");
          return;
        }

        renderComparison(object1, object2);
      }

      function parseObjectValue(value) {
        // –§–æ—Ä–º–∞—Ç: "model-{projectId}-{objectId}" –∏–ª–∏ "profile-{projectId}-{objectId}"
        const parts = value.split("-");
        if (parts.length !== 3) return null;

        const type = parts[0]; // 'model' –∏–ª–∏ 'profile'
        const projectId = parseInt(parts[1]);
        const objectId = parseInt(parts[2]);

        const project = MemoryStore.getProject(projectId);
        if (!project) return null;

        if (type === "model") {
          const model = project.models?.find((m) => m.id === objectId);
          if (model) {
            return {
              ...model,
              objectType: "model",
              projectName: project.name,
            };
          }
        } else if (type === "profile") {
          const profile = project.profiles?.find((p) => p.id === objectId);
          if (profile) {
            return {
              ...profile,
              objectType: "profile",
              projectName: project.name,
            };
          }
        }

        return null;
      }

      function renderComparison(obj1, obj2) {
        document.getElementById("comparison-results").style.display = "block";

        // Mock statistics
        const common =
          Math.min(obj1.classes || 0, obj2.classes || 0) -
          Math.floor(Math.random() * 10);
        const unique1 = (obj1.classes || 0) - common;
        const unique2 = (obj2.classes || 0) - common;

        document.getElementById("stat-common").textContent = common;
        document.getElementById("stat-unique1").textContent = unique1;
        document.getElementById("stat-unique2").textContent = unique2;

        // Object names with type indicator
        document.getElementById("profile1-name").textContent = `${obj1.name} (${
          obj1.objectType === "model" ? "–ú–æ–¥–µ–ª—å" : "–ü—Ä–æ—Ñ–∏–ª—å"
        })`;
        document.getElementById("profile2-name").textContent = `${obj2.name} (${
          obj2.objectType === "model" ? "–ú–æ–¥–µ–ª—å" : "–ü—Ä–æ—Ñ–∏–ª—å"
        })`;

        // Object details - different fields for models and profiles
        document.getElementById("profile1-details").innerHTML =
          '<table class="table">' +
          '<tr><td style="font-weight:600;">–ü—Ä–æ–µ–∫—Ç</td><td>' +
          obj1.projectName +
          "</td></tr>" +
          '<tr><td style="font-weight:600;">–¢–∏–ø</td><td>' +
          (obj1.objectType === "model" ? obj1.type : "–ü—Ä–æ—Ñ–∏–ª—å") +
          "</td></tr>" +
          (obj1.objectType === "profile" && obj1.baseModel
            ? '<tr><td style="font-weight:600;">–ë–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å</td><td>' +
              obj1.baseModel +
              "</td></tr>"
            : "") +
          (obj1.version
            ? '<tr><td style="font-weight:600;">–í–µ—Ä—Å–∏—è</td><td>' +
              obj1.version +
              "</td></tr>"
            : "") +
          '<tr><td style="font-weight:600;">–ö–ª–∞—Å—Å–æ–≤</td><td>' +
          (obj1.classes || 0) +
          "</td></tr>" +
          '<tr><td style="font-weight:600;">–ê—Ç—Ä–∏–±—É—Ç–æ–≤</td><td>' +
          (obj1.attributes || 0) +
          "</td></tr>" +
          (obj1.description
            ? '<tr><td style="font-weight:600;">–û–ø–∏—Å–∞–Ω–∏–µ</td><td>' +
              obj1.description +
              "</td></tr>"
            : "") +
          "</table>";

        document.getElementById("profile2-details").innerHTML =
          '<table class="table">' +
          '<tr><td style="font-weight:600;">–ü—Ä–æ–µ–∫—Ç</td><td>' +
          obj2.projectName +
          "</td></tr>" +
          '<tr><td style="font-weight:600;">–¢–∏–ø</td><td>' +
          (obj2.objectType === "model" ? obj2.type : "–ü—Ä–æ—Ñ–∏–ª—å") +
          "</td></tr>" +
          (obj2.objectType === "profile" && obj2.baseModel
            ? '<tr><td style="font-weight:600;">–ë–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å</td><td>' +
              obj2.baseModel +
              "</td></tr>"
            : "") +
          (obj2.version
            ? '<tr><td style="font-weight:600;">–í–µ—Ä—Å–∏—è</td><td>' +
              obj2.version +
              "</td></tr>"
            : "") +
          '<tr><td style="font-weight:600;">–ö–ª–∞—Å—Å–æ–≤</td><td>' +
          (obj2.classes || 0) +
          "</td></tr>" +
          '<tr><td style="font-weight:600;">–ê—Ç—Ä–∏–±—É—Ç–æ–≤</td><td>' +
          (obj2.attributes || 0) +
          "</td></tr>" +
          (obj2.description
            ? '<tr><td style="font-weight:600;">–û–ø–∏—Å–∞–Ω–∏–µ</td><td>' +
              obj2.description +
              "</td></tr>"
            : "") +
          "</table>";

        // Differences list
        const differences = [
          {
            type: "added",
            text: "–ö–ª–∞—Å—Å <strong>RotatingMachineInfo</strong> –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–æ—Ñ–∏–ª–µ 2",
          },
          {
            type: "removed",
            text: "–ö–ª–∞—Å—Å <strong>TransformerInfo</strong> –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–æ—Ñ–∏–ª–µ 1",
          },
          {
            type: "modified",
            text: "–ê—Ç—Ä–∏–±—É—Ç <strong>rotorGD2</strong> –∏–º–µ–µ—Ç —Ä–∞–∑–Ω—É—é –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å: [0..1] –≤ –ø—Ä–æ—Ñ–∏–ª–µ 1, [1] –≤ –ø—Ä–æ—Ñ–∏–ª–µ 2",
          },
          {
            type: "added",
            text: "–ê—Ç—Ä–∏–±—É—Ç <strong>ratedVoltage</strong> –¥–æ–±–∞–≤–ª–µ–Ω –≤ –ø—Ä–æ—Ñ–∏–ª–µ 2",
          },
        ];

        const diffHtml = differences
          .map((d) => {
            const cls =
              d.type === "added"
                ? "diff-added"
                : d.type === "removed"
                ? "diff-removed"
                : "badge";
            const icon =
              d.type === "added" ? "‚ûï" : d.type === "removed" ? "‚ûñ" : "üîÑ";
            return (
              '<div class="card difference-item">' +
              '<span class="' +
              cls +
              ' difference-icon">' +
              icon +
              "</span>" +
              d.text +
              "</div>"
            );
          })
          .join("");

        document.getElementById("differences-list").innerHTML = diffHtml;
      }
    </script>
  </body>
</html>
