<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nautilus.CIM - –ú–æ–¥–µ–ª–∏</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <!-- SIDEBAR -->
        <div class="sidebar">
            <div class="sidebar-header">
                <strong>Nautilus.CIM</strong>
            </div>
            <div class="sidebar-nav">
                <a href="index.html" class="nav-item">üìä –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</a>
                <a href="projects.html" class="nav-item">üìÅ –ü—Ä–æ–µ–∫—Ç—ã</a>
                <a href="models.html" class="nav-item active">üìã –ú–æ–¥–µ–ª–∏</a>
                <a href="profiles.html" class="nav-item">‚öôÔ∏è –ü—Ä–æ—Ñ–∏–ª–∏</a>
                
                <div class="nav-section-title">–¢–µ–∫—É—â–∏–π –ø—Ä–æ–µ–∫—Ç</div>
                <div id="current-project" style="padding: 10px 15px; font-size: 12px; color: rgba(255,255,255,0.7);">
                    –ù–µ—Ç –ø—Ä–æ–µ–∫—Ç–∞
                </div>

                <div class="nav-section-title">–î–µ–π—Å—Ç–≤–∏—è</div>
                <div class="nav-item" onclick="openModal('new-project-modal')">+ –ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</div>
                <div class="nav-item" onclick="openModal('new-model-modal')">‚¨ÜÔ∏è –ò–º–ø–æ—Ä—Ç –º–æ–¥–µ–ª–∏</div>
                <a href="compare.html" class="nav-item">üîç –°—Ä–∞–≤–Ω–µ–Ω–∏–µ</a>
            </div>
        </div>

        <!-- MAIN CONTENT -->
        <div class="main-content">
            <div class="toolbar">
                <div class="toolbar-title">–ú–æ–¥–µ–ª–∏</div>
                <div class="toolbar-actions">
                    <button class="btn btn-secondary" onclick="openDiagram()" id="diagram-btn" style="display:none;">
                        üìê –î–∏–∞–≥—Ä–∞–º–º–∞ –∫–ª–∞—Å—Å–æ–≤
                    </button>
                    <button class="btn btn-primary" onclick="openModal('new-model-modal')">+ –î–æ–±–∞–≤–∏—Ç—å –º–æ–¥–µ–ª—å</button>
                </div>
            </div>

            <div class="content-area">
                <div id="no-project-warning" style="display:none; padding:40px; text-align:center; color:var(--text-secondary);">
                    <div style="font-size:48px; margin-bottom:15px;">üìÅ</div>
                    <h3>–ü—Ä–æ–µ–∫—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω</h3>
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –º–æ–¥–µ–ª–µ–π</p>
                    <button class="btn btn-primary" onclick="window.location.href='projects.html'" style="margin-top:15px;">–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø—Ä–æ–µ–∫—Ç–∞–º</button>
                </div>

                <div id="models-container" style="display:none;">
                    <div class="split-view">
                        <div class="split-left">
                            <h3 style="margin-bottom:15px; font-size:16px;">–°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π</h3>
                            <div id="models-list"></div>
                        </div>
                        <div class="split-right">
                            <div id="model-details">
                                <div style="text-align:center; color:var(--text-secondary); padding:40px;">
                                    –í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: New Model -->
    <div id="new-model-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –º–æ–¥–µ–ª—å –≤ –ø—Ä–æ–µ–∫—Ç</div>
            <div class="form-group">
                <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ *</label>
                <input type="text" id="model-name" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: TC57CIM, IEC61970">
            </div>
            <div class="form-group">
                <label class="form-label">–¢–∏–ø –º–æ–¥–µ–ª–∏</label>
                <select id="model-type" class="form-select">
                    <option>–ö–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å</option>
                    <option>–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                <textarea id="model-desc" class="form-textarea" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∞—Å—Å–æ–≤ (–ø—Ä–∏–º–µ—Ä–Ω–æ)</label>
                <input type="number" id="model-classes" class="form-input" value="100">
            </div>
            <div class="form-group">
                <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ (–ø—Ä–∏–º–µ—Ä–Ω–æ)</label>
                <input type="number" id="model-attributes" class="form-input" value="500">
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeModal('new-model-modal')">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="createModel()">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <div id="new-project-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</div>
            <div class="form-group">
                <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ *</label>
                <input type="text" id="project-name" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
            </div>
            <div class="form-group">
                <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                <textarea id="project-desc" class="form-textarea" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">–í–µ—Ä—Å–∏—è</label>
                <input type="text" id="project-version" class="form-input" value="1.0">
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeModal('new-project-modal')">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="alert('–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤ —Ä–∞–∑–¥–µ–ª–µ –ü—Ä–æ–µ–∫—Ç—ã')">–°–æ–∑–¥–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <script src="data.js"></script>
    <script>
        let selectedModelId = null;
        let selectedModelName = null;

        document.addEventListener('DOMContentLoaded', () => {
            loadSampleData();
            updateCurrentProject();
            checkProject();
        });

        function checkProject() {
            const projectId = getCurrentProjectId();
            if (!projectId) {
                document.getElementById('no-project-warning').style.display = 'block';
                document.getElementById('models-container').style.display = 'none';
            } else {
                document.getElementById('no-project-warning').style.display = 'none';
                document.getElementById('models-container').style.display = 'block';
                renderModels();
            }
        }

        function renderModels() {
            const projectId = getCurrentProjectId();
            const models = getModels(projectId);
            
            const html = models.map(m => `
                <div class="tree-item ${selectedModelId === m.id ? 'selected' : ''}" onclick="selectModel(${m.id}, '${m.name}')">
                    üì¶ ${m.name}
                </div>
            `).join('');
            
            document.getElementById('models-list').innerHTML = html || '<div style="padding:10px; color:var(--text-secondary);">–ù–µ—Ç –º–æ–¥–µ–ª–µ–π</div>';
        }

        function selectModel(modelId, modelName) {
            selectedModelId = modelId;
            selectedModelName = modelName;
            renderModels();
            renderModelDetails();
            document.getElementById('diagram-btn').style.display = 'inline-flex';
        }

        function openDiagram() {
            if (!selectedModelName) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å');
                return;
            }
            window.location.href = 'diagram.html?model=' + encodeURIComponent(selectedModelName);
        }

        function renderModelDetails() {
            const projectId = getCurrentProjectId();
            const model = getModel(projectId, selectedModelId);
            
            if (!model) return;
            
            const structure = getSampleClassStructure();
            const treeHtml = renderTree(structure[model.name] || []);
            
            const html = `
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('properties')">–°–≤–æ–π—Å—Ç–≤–∞</div>
                    <div class="tab" onclick="switchTab('structure')">–°—Ç—Ä—É–∫—Ç—É—Ä–∞</div>
                    <div class="tab" onclick="switchTab('stats')">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                </div>
                
                <div id="tab-properties" class="tab-content active">
                    <div class="flex-between mb-15">
                        <h3 style="margin:0;">${model.name}</h3>
                        <button class="btn btn-primary btn-small" onclick="openDiagram()">üìê –î–∏–∞–≥—Ä–∞–º–º–∞ –∫–ª–∞—Å—Å–æ–≤</button>
                    </div>
                    <table class="table">
                        <tr>
                            <td style="font-weight:600; width:200px;">–¢–∏–ø –º–æ–¥–µ–ª–∏</td>
                            <td><span class="badge">${model.type}</span></td>
                        </tr>
                        <tr>
                            <td style="font-weight:600;">–û–ø–∏—Å–∞–Ω–∏–µ</td>
                            <td>${model.description}</td>
                        </tr>
                        <tr>
                            <td style="font-weight:600;">–ö–ª–∞—Å—Å–æ–≤</td>
                            <td>${model.classes}</td>
                        </tr>
                        <tr>
                            <td style="font-weight:600;">–ê—Ç—Ä–∏–±—É—Ç–æ–≤</td>
                            <td>${model.attributes}</td>
                        </tr>
                    </table>
                </div>
                
                <div id="tab-structure" class="tab-content">
                    <h3 style="margin-bottom:15px;">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–∫–µ—Ç–æ–≤ –∏ –∫–ª–∞—Å—Å–æ–≤</h3>
                    <div class="tree">${treeHtml}</div>
                </div>
                
                <div id="tab-stats" class="tab-content">
                    <h3 style="margin-bottom:15px;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–æ–¥–µ–ª–∏</h3>
                    <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:15px;">
                        <div class="stat-box">
                            <div class="stat-value">${model.classes}</div>
                            <div class="stat-label">–í—Å–µ–≥–æ –∫–ª–∞—Å—Å–æ–≤</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value">${model.attributes}</div>
                            <div class="stat-label">–í—Å–µ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–æ–≤</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value">${model.packages ? model.packages.length : 'N/A'}</div>
                            <div class="stat-label">–ü–∞–∫–µ—Ç–æ–≤</div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('model-details').innerHTML = html;
        }

        function renderTree(items, level = 0) {
            return items.map(item => {
                const icon = item.type === 'package' ? 'üìÅ' : (item.type === 'class' ? 'üìÑ' : '‚Ä¢');
                const children = item.children ? `<div class="tree-children">${renderTree(item.children, level + 1)}</div>` : '';
                return `
                    <div>
                        <div class="tree-item" style="padding-left:${level * 20 + 10}px;">
                            ${icon} ${item.name}
                            ${item.stereotype ? `<span class="badge-secondary">${item.stereotype}</span>` : ''}
                        </div>
                        ${children}
                    </div>
                `;
            }).join('');
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById('tab-' + tabName).classList.add('active');
        }

        function createModel() {
            const projectId = getCurrentProjectId();
            if (!projectId) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç');
                return;
            }
            
            const name = document.getElementById('model-name').value.trim();
            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏');
                return;
            }
            
            const newModel = {
                name: name,
                type: document.getElementById('model-type').value,
                description: document.getElementById('model-desc').value,
                classes: parseInt(document.getElementById('model-classes').value) || 100,
                attributes: parseInt(document.getElementById('model-attributes').value) || 500,
                packages: []
            };
            
            addModel(projectId, newModel);
            closeModal('new-model-modal');
            
            // Clear form
            document.getElementById('model-name').value = '';
            document.getElementById('model-desc').value = '';
            document.getElementById('model-classes').value = '100';
            document.getElementById('model-attributes').value = '500';
            
            renderModels();
            alert('–ú–æ–¥–µ–ª—å —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
        }
    </script>
</body>
</html>