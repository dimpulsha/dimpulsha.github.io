<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nautilus.CIM - –ü—Ä–æ—Ñ–∏–ª–∏</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <!-- SIDEBAR -->
        <div class="sidebar">
            <div class="sidebar-header">
                <strong>Nautilus.CIM</strong>
            </div>
            <div class="sidebar-nav">
                <a href="index.html" class="nav-item">üìä –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</a>
                <a href="projects.html" class="nav-item">üìÅ –ü—Ä–æ–µ–∫—Ç—ã</a>
                <a href="models.html" class="nav-item">üìã –ú–æ–¥–µ–ª–∏</a>
                <a href="profiles.html" class="nav-item active">‚öôÔ∏è –ü—Ä–æ—Ñ–∏–ª–∏</a>
                
                <div class="nav-section-title">–¢–µ–∫—É—â–∏–π –ø—Ä–æ–µ–∫—Ç</div>
                <div id="current-project" class="current-project-info">
                    –ù–µ—Ç –ø—Ä–æ–µ–∫—Ç–∞
                </div>

                <div class="nav-section-title">–î–µ–π—Å—Ç–≤–∏—è</div>
                <div class="nav-item" onclick="openModal('new-project-modal')">+ –ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</div>
                <div class="nav-item" onclick="openModal('new-model-modal')">‚¨ÜÔ∏è –ò–º–ø–æ—Ä—Ç –º–æ–¥–µ–ª–∏</div>
                <a href="compare.html" class="nav-item">üîç –°—Ä–∞–≤–Ω–µ–Ω–∏–µ</a>
            </div>
        </div>

        <!-- MAIN CONTENT -->
        <div class="main-content">
            <div class="toolbar">
                <div class="toolbar-title">–ü—Ä–æ—Ñ–∏–ª–∏</div>
                <div class="toolbar-actions">
                    <button class="btn btn-secondary" onclick="openDiagram()" id="diagram-btn" class="hidden">
                        üìê –î–∏–∞–≥—Ä–∞–º–º–∞ –∫–ª–∞—Å—Å–æ–≤
                    </button>
                    <button class="btn btn-primary" onclick="openModal('new-profile-modal')">+ –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
                </div>
            </div>

            <div class="content-area">
                <div id="no-project-warning" class="hidden">
                    <div class="warning-title">
                        <div class="model-icon-large">üìÅ</div>
                        <h3>–ü—Ä–æ–µ–∫—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω</h3>
                        <p>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ—Ñ–∏–ª—è–º–∏</p>
                        <button class="btn btn-primary mt-15" onclick="window.location.href='projects.html'">–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø—Ä–æ–µ–∫—Ç–∞–º</button>
                    </div>
                </div>

                <div id="profiles-container" class="hidden">
                    <div class="split-view">
                        <div class="split-left">
                            <h3 class="mb-15">–°–ø–∏—Å–æ–∫ –ø—Ä–æ—Ñ–∏–ª–µ–π</h3>
                            <div id="profiles-list"></div>
                        </div>
                        <div class="split-right">
                            <div id="profile-details">
                                <div class="text-center">
                                    –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: New Profile -->
    <div id="new-profile-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å</div>
            <div class="form-group">
                <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è *</label>
                <input type="text" id="profile-name" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: GOST-58651.2">
            </div>
            <!-- <div class="form-group">
                <label class="form-label">–ë–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å *</label>
                <select id="profile-base-model" class="form-select">
                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å --</option>
                </select>
            </div> -->
            <div class="form-group">
                <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                <textarea id="profile-desc" class="form-textarea" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">–í–µ—Ä—Å–∏—è</label>
                <input type="text" id="profile-version" class="form-input" value="1.0">
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeModal('new-profile-modal')">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="createProfile()">–°–æ–∑–¥–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <div id="new-project-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</div>
            <p class="modal-info-text">–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤ —Ä–∞–∑–¥–µ–ª–µ "–ü—Ä–æ–µ–∫—Ç—ã"</p>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="window.location.href='projects.html'">–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø—Ä–æ–µ–∫—Ç–∞–º</button>
            </div>
        </div>
    </div>

    <div id="new-model-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –º–æ–¥–µ–ª—å</div>
            <p class="modal-info-text">–î–æ–±–∞–≤—å—Ç–µ –º–æ–¥–µ–ª—å –≤ —Ä–∞–∑–¥–µ–ª–µ "–ú–æ–¥–µ–ª–∏"</p>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="window.location.href='models.html'">–ü–µ—Ä–µ–π—Ç–∏ –∫ –º–æ–¥–µ–ª—è–º</button>
            </div>
        </div>
    </div>

    <script src="data.js"></script>
    <script>
        let selectedProfileId = null;
        let selectedProfileName = null;

        document.addEventListener('DOMContentLoaded', () => {
            loadSampleData();
            updateCurrentProject();
            checkProject();
        });

        function checkProject() {
            const projectId = getCurrentProjectId();
            if (!projectId) {
                document.getElementById('no-project-warning').style.display = 'block';
                document.getElementById('profiles-container').style.display = 'none';
            } else {
                document.getElementById('no-project-warning').style.display = 'none';
                document.getElementById('profiles-container').style.display = 'block';
                renderProfiles();
                loadModelOptions();
            }
        }

        function loadModelOptions() {
            const projectId = getCurrentProjectId();
            const models = getModels(projectId);
            const select = document.getElementById('profile-base-model');
            
            select.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å --</option>' + 
                models.map(m => `<option value="${m.name}">${m.name}</option>`).join('');
        }

        function renderProfiles() {
            const projectId = getCurrentProjectId();
            const profiles = getProfiles(projectId);
            
            const html = profiles.map(p => `
                <div class="tree-item ${selectedProfileId === p.id ? 'selected' : ''}" onclick="selectProfile(${p.id}, '${p.name}')">
                    ‚öôÔ∏è ${p.name}
                </div>
            `).join('');
            
            document.getElementById('profiles-list').innerHTML = html || '<div class="no-items text-muted">–ù–µ—Ç –ø—Ä–æ—Ñ–∏–ª–µ–π</div>';
        }

        function selectProfile(profileId, profileName) {
            selectedProfileId = profileId;
            selectedProfileName = profileName;
            renderProfiles();
            renderProfileDetails();
            document.getElementById('diagram-btn').style.display = 'inline-flex';
        }

        function openDiagram() {
            if (!selectedProfileName) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å');
                return;
            }
            window.location.href = 'diagram.html?profile=' + encodeURIComponent(selectedProfileName);
        }

        function renderProfileDetails() {
            const projectId = getCurrentProjectId();
            const profile = getProfile(projectId, selectedProfileId);
            
            if (!profile) return;
            
            const xsdCode = profile.xsd || `<?xml version="1.0" encoding="UTF-8"?>
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema">
  <!-- –ü—Ä–æ—Ñ–∏–ª—å ${profile.name} -->
  <xs:element name="Profile" type="ProfileType"/>
  <xs:complexType name="ProfileType">
    <xs:sequence>
      <xs:element name="id" type="xs:string"/>
      <xs:element name="name" type="xs:string"/>
    </xs:sequence>
  </xs:complexType>
</xs:schema>`;
            
            const html = `
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('properties')">–°–≤–æ–π—Å—Ç–≤–∞</div>
                    <div class="tab" onclick="switchTab('structure')">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Å–æ–≤</div>
                    <div class="tab" onclick="switchTab('xsd')">XSD –∫–æ–¥</div>
                </div>
                
                <div id="tab-properties" class="tab-content active">
                    <div class="flex-between mb-15">
                        <h3 class="no-margin">${profile.name}</h3>
                        <button class="btn btn-primary btn-small" onclick="openDiagram()">üìê –î–∏–∞–≥—Ä–∞–º–º–∞ –∫–ª–∞—Å—Å–æ–≤</button>
                    </div>
                    <table class="table">
                        <tr>
                            <td class="table-label">–ë–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å</td>
                            <td><span class="badge">${profile.baseModel}</span></td>
                        </tr>
                        <tr>
                            <td class="table-label">–í–µ—Ä—Å–∏—è</td>
                            <td>${profile.version}</td>
                        </tr>
                        <tr>
                            <td class="table-label">–û–ø–∏—Å–∞–Ω–∏–µ</td>
                            <td>${profile.description}</td>
                        </tr>
                        <tr>
                            <td class="table-label">–ö–ª–∞—Å—Å–æ–≤ –≤ –ø—Ä–æ—Ñ–∏–ª–µ</td>
                            <td>${profile.classes}</td>
                        </tr>
                        <tr>
                            <td class="table-label">–ê—Ç—Ä–∏–±—É—Ç–æ–≤</td>
                            <td>${profile.attributes}</td>
                        </tr>
                    </table>
                    
                    <div class="mt-20">
                        <button class="btn btn-primary" onclick="alert('–§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">üì• –≠–∫—Å–ø–æ—Ä—Ç XSD</button>
                        <button class="btn btn-secondary" onclick="alert('–§—É–Ω–∫—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">‚úì –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>
                </div>
                
                <div id="tab-structure" class="tab-content">
                    <h3 class="mb-15">–ö–ª–∞—Å—Å—ã –ø—Ä–æ—Ñ–∏–ª—è</h3>
                    <div class="tree">
                        <div class="tree-item">üì¶ ${profile.baseModel}</div>
                        <div class="tree-children">
                            <div class="tree-item">üìÅ AssetInfo</div>
                            <div class="tree-children">
                                <div class="tree-item">üìÑ RotatingMachineInfo <span class="badge-secondary">rf</span></div>
                                <div class="tree-children">
                                    <div class="tree-item">‚Ä¢ rotorGD2: Torque [0..1]</div>
                                    <div class="tree-item">‚Ä¢ ratedVoltage: Voltage [1]</div>
                                </div>
                                <div class="tree-item">üìÑ SynchronousMachineInfo</div>
                                <div class="tree-item">üìÑ AsynchronousMachineInfo</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="tab-xsd" class="tab-content">
                    <h3 class="mb-15">XSD Schema</h3>
                    <div class="code-block">${escapeHtml(xsdCode)}</div>
                    <div class="mt-15">
                        <button class="btn btn-secondary" onclick="copyCode()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>
                </div>
            `;
            
            document.getElementById('profile-details').innerHTML = html;
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById('tab-' + tabName).classList.add('active');
        }

        function createProfile() {
            const projectId = getCurrentProjectId();
            if (!projectId) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç');
                return;
            }
            
            const name = document.getElementById('profile-name').value.trim();
            const baseModel = document.getElementById('profile-base-model').value;
            
            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è');
                return;
            }
            
            // if (!baseModel) {
            //     alert('–í—ã–±–µ—Ä–∏—Ç–µ –±–∞–∑–æ–≤—É—é –º–æ–¥–µ–ª—å');
            //     return;
            // }
            
            const newProfile = {
                name: name,
                // baseModel: baseModel,
                description: document.getElementById('profile-desc').value,
                version: document.getElementById('profile-version').value,
                // classes: Math.floor(Math.random() * 50) + 20,
                // attributes: Math.floor(Math.random() * 200) + 100
            };
            
            addProfile(projectId, newProfile);
            closeModal('new-profile-modal');
            
            // Clear form
            document.getElementById('profile-name').value = '';
            document.getElementById('profile-desc').value = '';
            document.getElementById('profile-version').value = '1.0';
            // document.getElementById('profile-base-model').value = '';
            
            renderProfiles();
            alert('–ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function copyCode() {
            const code = document.querySelector('.code-block').textContent;
            navigator.clipboard.writeText(code).then(() => {
                alert('–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
            });
        }
    </script>
</body>
</html>